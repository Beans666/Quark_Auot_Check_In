name: Quark签到

on:
  schedule:
    - cron: '25 5 * * *'   # 北京时间 13:25 (UTC+8 → UTC 05:25) （仅用于验证）
  workflow_dispatch:      # 允许手动触发

jobs:
  verify-sign:
    runs-on: ubuntu-latest
    steps:
      - name: 检出代码
        uses: actions/checkout@v4

      - name: 输出触发信息（验证定时生效）
        run: |
          echo "===== 定时触发验证 ====="
          echo "当前北京时间: $(TZ='Asia/Shanghai' date '+%Y-%m-%d %H:%M:%S')"
          echo "定时任务已成功触发！"

      - name: 随机延迟（模拟真实执行）
        run: |
          delay=$((RANDOM % 10))
          echo "延迟 $delay 秒后执行后续步骤.."
          sleep $delay

      - name: 设置Python环境
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: 安装依赖
        run: pip install requests

      - name: 执行签到脚本（验证执行）
        env:
          COOKIE_QUARK: ${{ secrets.COOKIE_QUARK }}
          PUSHPLUS_TOKEN: ${{ secrets.PUSHPLUS_TOKEN }}
        run: |
          echo "执行签到脚本（验证模式）"
          python checkIn_Quark.py || echo "脚本执行完成（即使报错也说明定时生效）"

      - name: 清理旧记录（轻量化）
        uses: Mattraks/delete-workflow-runs@main
        if: always()
        with:
          token: ${{ github.token }}
          repository: ${{ github.repository }}
          retain_days: 0
          keep_minimum_runs: 10
